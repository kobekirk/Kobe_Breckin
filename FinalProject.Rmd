---
title: "Offensive in the NFL"
output: 
  flexdashboard::flex_dashboard:
    theme: cerulean
    orientation: rows
    vertical_layout: scroll
    css: style.css
runtime: shiny
---

```{r global, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(stringr)
library(rvest)
library(polite)
library(sf)
library(maps)
library(viridis)
library(leaflet)
library(htmltools)
library(janitor)
library(purrr)
library(ggrepel)
```

```{r, echo = FALSE}

full_table <- read.csv("mydata.csv")

full_table <- full_table |>
  mutate(
    indendend_air_yard = as.numeric(indendend_air_yard),
    pass_attempts = as.numeric(pass_attempts),
    rush_attempts = as.numeric(rush_attempts),
    points_scored = as.numeric(points_scored)
  ) |>
  mutate(
    air_yards_per_pa = indendend_air_yard / pass_attempts,
    points_per_pa = points_scored / pass_attempts,
    points_per_ra = points_scored / rush_attempts,
    wins   = as.numeric(str_extract(record, "^[0-9]+")),
    losses = as.numeric(str_extract(record, "(?<=-)[0-9]+")),
    win_percentage = wins / (wins + losses),
    wins_per_pa = wins / pass_attempts,
    wins_per_ra = wins / rush_attempts,
    rush_percentage = rush_attempts / (rush_attempts + pass_attempts),
    pass_percentage = pass_attempts / (rush_attempts + pass_attempts)
  )

metrics <- c(
  "Pass Attempts" = "pass_attempts",
  "Rush Attempts" = "rush_attempts",
  "On Target Percentage" = "on_target",
  "Rushing Yards Before Contact per Attempt" = "rush_before_contact",
  "Points Scored" = "points_scored",
  "Intended Air Yards per Pass Attempt" = "air_yards_per_pa",
  "Points Scored per Pass Attempt" = "points_per_pa",
  "Points Scored per Rush Attempt" = "points_per_ra",
  "Wins" = "wins",
  "Losses" = "losses",
  "Winning Percentage" = "win_percentage",
  "Wins per Pass Attempt" = "wins_per_pa",
  "Wins per Rush Attempt" = "wins_per_ra",
  "% of Plays Rushing" = "rush_percentage",
  "% of Plays Passing" = "pass_percentage"
)
```

About
==========================

Row {data-height=auto}
--------------------------------------
<div style="max-width:1200px; line-height:1.6; font-size:25px;">
### Overview

**What this dashboard does:**  
This interactive dashboard examines how offensive play style relates to team success in the National Football League (NFL). Using five seasons of team-level data, we analyze how passing and rushing tendencies are associated with points scored and wins, while allowing users to explore advanced efficiency metrics through interactive visualizations.

**Main Research Questions**

- How do **pass attempts** and **rush attempts** relate to total points scored?
- How do offensive tendencies relate to **wins** over a season?

**Our Hypothesis**

We predict that when rush attempts increase the teams winning percentage increases as they are ahead and want to run out the clock. On the other hand we predict that as pass attempts increase the winning percentage decreases because these teams are having to play from behind and mount a comeback.

**Derived Metrics**

- Intended air yards per pass attempt  
- Winning percentage  
- Points per pass attempt  
- Points per rush attempt  
- Wins per pass attempt  
- Wins per rush attempt  


**Acknowledgments:**  
All data used in this dashboard were collected from [Pro Football Reference](https://www.pro-football-reference.com).
This dashboard was developed for educational purposes.

Check out our code on [Github](https://github.com/kobekirk/Kobe_Breckin/blob/main/FinalProject.Rmd)!

</div>
```{r, echo=FALSE, fig.align='center', out.width='800px'}
knitr::include_graphics(path.expand("~/Kobe_Breckin/images/nfl-logo-png-0.png"))
```



Interactive EDA Models
==========================


```{r, echo = FALSE}

nfl_colors <- c(
  CRD = "#97233F",  # Cardinals
  ATL = "#A71930",  # Falcons
  RAV = "#241773",  # Ravens
  BUF = "#00338D",  # Bills
  CAR = "#0085CA",  # Panthers
  CHI = "#0B162A",  # Bears
  CIN = "#FB4F14",  # Bengals
  CLE = "#311D00",  # Browns
  DAL = "#003594",  # Cowboys
  DEN = "#FB4F14",  # Broncos
  DET = "#0076B6",  # Lions
  GNB = "#203731",  # Packers
  HTX = "#03202F",  # Texans
  CLT = "#002C5F",  # Colts
  JAX = "#006778",  # Jaguars
  KAN = "#E31837",  # Chiefs
  RAI = "#000000",  # Raiders
  SDG = "#0080C6",  # Chargers (legacy SDG)
  RAM = "#003594",  # Rams
  MIA = "#008E97",  # Dolphins
  MIN = "#4F2683",  # Vikings
  NWE = "#002244",  # Patriots
  NOR = "#D3BC8D",  # Saints
  NYG = "#0B2265",  # Giants
  NYJ = "#125740",  # Jets
  PHI = "#004C54",  # Eagles
  PIT = "#FFB612",  # Steelers
  SFO = "#AA0000",  # 49ers
  SEA = "#002244",  # Seahawks
  TAM = "#D50A0A",  # Buccaneers
  OTI = "#4B92DB",  # Titans
  WAS = "#5A1414"   # Commanders
)

metrics <- c(
  "Pass Attempts" = "pass_attempts",
  "Rush Attempts" = "rush_attempts",
  "On Target Percentage" = "on_target",
  "Rushing Yards Before Contact per Attempt" = "rush_before_contact",
  "Points Scored" = "points_scored",
  "Intended Air Yards per Pass Attempt" = "air_yards_per_pa",
  "Points Scored per Pass Attempt" = "points_per_pa",
  "Points Scored per Rush Attempt" = "points_per_ra",
  "Wins" = "wins",
  "Losses" = "losses",
  "Winning Percentage" = "win_percentage",
  "Wins per Pass Attempt" = "wins_per_pa",
  "Wins per Rush Attempt" = "wins_per_ra",
  "% of Plays Rushing" = "rush_percentage",
  "% of Plays Passing" = "pass_percentage"
)

year1 <- c(2020, 2021, 2022, 2023, 2024)

selectInput(
  "metric",
  "Choose a metric for x-axis:",
  choices  = metrics,
  selected = "pass_attempts",   # value, not label
  multiple = FALSE
)

selectInput(
  "year1",
  "Select a year:",
  choices  = year1,
  multiple = FALSE
)

renderPlot({
  req(input$metric, input$year1)

  metric_col <- input$metric                         # e.g. "pass_attempts"
  metric_lab <- names(metrics)[metrics == metric_col] # e.g. "Pass Attempts"

  filtered <- full_table |>
    dplyr::filter(year == input$year1)

  ggplot(filtered, aes(
    x = reorder(team, -.data[[metric_col]]),
    y = .data[[metric_col]],
    fill = team
  )) +
    geom_col(alpha = 0.9) +
    scale_fill_manual(values = nfl_colors) +
    labs(
      x     = "Team",
      y     = metric_lab,
      title = paste("NFL Team:", metric_lab, "-", input$year1)
    ) +
    theme_minimal(base_size = 16) +
    theme(legend.position = "none")
})
```


```{r, echo = FALSE}
inputPanel(
  selectInput("year", "Select Year:", choices = sort(unique(full_table$year))))

renderPlot({

  req(input$year)

  # Filter to selected year and ensure one point per team
  df <- full_table |>
    filter(year == input$year) |>
    distinct(team, .keep_all = TRUE)  # team column contains 3-letter abbrevs

  # Compute league averages
  nfl_avg_pass <- mean(df$pass_percentage, na.rm = TRUE)
  nfl_avg_rush <- mean(df$rush_percentage, na.rm = TRUE)

  ggplot(df, aes(
    x = pass_percentage,
    y = rush_percentage,
    color = team
  )) +
    geom_point(size = 4) +
    geom_text_repel(aes(label = team),
                    nudge_y = 0.03,
                    size = 4,
                    fontface = "bold",
                    show.legend = FALSE) +
    # NFL average lines
    geom_vline(xintercept = nfl_avg_pass, linetype = "dashed", color = "black") +
    geom_hline(yintercept = nfl_avg_rush, linetype = "dashed", color = "black") +
    scale_color_manual(values = nfl_colors) +
    labs(
      x = "Proportion Pass",
      y = "Proportion Rush",
      title = paste("Offensive Play Tendencies —", input$year),
      subtitle = "NFL average indicated by the dashed lines"
    ) +
    theme_minimal(base_size = 15) +
    theme(legend.position = "none")  # hide legend

})
```


## Plot 3

```{r, echo=FALSE}
selectInput(
  "team",
  "Select a team:",
  choices = sort(unique(full_table$team)),
  selected = "NWE",
  multiple = FALSE
)

selectInput(
  "metric_time",
  "Choose a metric:",
  choices = metrics,
  selected = "wins",
  multiple = FALSE
)

renderPlot({
  req(input$team, input$metric_time)

  # Team-specific data
  team_data <- full_table |>
    dplyr::filter(
      team == input$team,
      year %in% 2020:2024
    )

  # NFL average by year
  nfl_avg <- full_table |>
    dplyr::filter(year %in% 2020:2024) |>
    dplyr::group_by(year) |>
    dplyr::summarise(
      avg_metric = mean(.data[[input$metric_time]], na.rm = TRUE),
      .groups = "drop"
    )

  ggplot() +
    # Team line
    geom_line(data = team_data,aes(x = year,y = .data[[input$metric_time]]),
      linewidth = 2.5,
      color = nfl_colors[input$team]) +
    geom_point(
      data = team_data,aes(x = year,y = .data[[input$metric_time]]),
      size = 3,
      color = nfl_colors[input$team]
    ) +
    # NFL average dotted line
    geom_line(
      data = nfl_avg,
      aes(
        x = year,
        y = avg_metric
      ),
      linetype = "dotted",
      color = "red",
      linewidth = 2.5
    ) +
    scale_x_continuous(breaks = 2020:2024) +
    labs(
      x = "Season",
      y = input$metric_time,
      title = paste(input$team, input$metric_time, "(2020–2024)"),
      subtitle = "NFL average denoted by the red dotted line"
    ) +
    theme_minimal(base_size = 16)
})
```


Our Analysis
==========================

```{r, echo = FALSE, fig.height=14}
# Subset of metrics allowed for x-axis
x_choices <- metrics[
  names(metrics) %in% c(
    "Pass Attempts",
    "Rush Attempts",
    "On Target Percentage",
    "Rushing Yards Before Contact per Attempt",
    "Intended Air Yards per Pass Attempt",
    "Intended Air Yards per Rush Attempt",
    "% of Plays Passing",
    "% of Plays Rushing"
  )
]

# UI dropdowns ----
selectInput(
  "metric",
  "Choose a metric for the x-axis:",
  choices  = x_choices,           # << only the subset
  selected = "pass_attempts",
  multiple = FALSE
)

selectInput(
  "ymetric",
  "Choose a metric for the y-axis:",
  choices = metrics[names(metrics) %in% c("Winning Percentage", "Points Scored")],
  selected = "win_percentage"
)

# Plot ----
renderPlot({
  req(input$metric, input$ymetric)

  df <- full_table

  x_col <- input$metric
  y_col <- input$ymetric

  x_lab <- names(metrics)[metrics == x_col]
  y_lab <- names(metrics)[metrics == y_col]

  ggplot(df, aes(
    x = .data[[x_col]],
    y = .data[[y_col]]
  )) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE) +
    labs(
      x = x_lab,
      y = y_lab,
      title = paste(x_lab, "vs", y_lab)
    ) +
    theme_minimal(base_size = 16)
})
```

### Conclusion

<div style="max-width:2000px; line-height:1.6; font-size:20px;">

The first question we planned to address was: How does an NFL team’s total pass/rush attempts in a given season affect the amount of points that team scores in the season? As we can see in the graph above, as a team’s pass attempts increase, the amount of points they score remains generally the same. However, as a team’s rush attempts increase, we begin to see some positive correlation, as points scored also increase. We see similar results for our second question: How does an NFL team’s total pass/rush attempts in a given season affect the number of wins that team achieves in the season? While the number of pass attempts does not correlate with a team’s winning percentage, the number of rush attempts does increase likewise to winning percentage. Where we do start to see correlation between passing and winning percentage is with the percentage of a team’s playcalls that are passes, and there is actually a slight negative correlation, as winning percentage decreases as a team’s percentage of pass plays increases. As football fans, we expected these correlations, as teams that are winning tend to run the football more, to eat up the clock, while teams that are losing tend to throw the football more, in hopes of erasing their deficit more quickly.

</div>
